<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="侯乾">
    
    <!-- Completely eliminate flash of wrong theme -->
    <script>
        (function() {
            const THEME_KEY = "REDEFINE-THEME-STATUS";
            const DARK = "dark", LIGHT = "light";
            
            // Get preferred theme
            function getTheme() {
                try {
                    const saved = localStorage.getItem(THEME_KEY);
                    if (saved) {
                        const { isDark } = JSON.parse(saved);
                        return isDark ? DARK : LIGHT;
                    }
                } catch (e) {}
                
                return matchMedia("(prefers-color-scheme: dark)").matches ? DARK : LIGHT;
            }
            
            // Apply theme to document
            function applyTheme(theme) {
                const isDark = theme === DARK;
                const root = document.documentElement;
                
                // Set data attribute for CSS variables
                root.setAttribute("data-theme", theme);
                
                // Set classes for compatibility
                root.classList.add(theme);
                root.classList.remove(isDark ? LIGHT : DARK);
                root.style.colorScheme = theme;
            }
            
            // Initial application
            const theme = getTheme();
            applyTheme(theme);
            
            // Listen for system preference changes
            matchMedia("(prefers-color-scheme: dark)").addEventListener("change", ({ matches }) => {
                // Only update if using system preference (no localStorage entry)
                if (!localStorage.getItem(THEME_KEY)) {
                    applyTheme(matches ? DARK : LIGHT);
                }
            });
            
            // Set body classes once DOM is ready
            if (document.readyState !== "loading") {
                document.body.classList.add(theme + "-mode");
            } else {
                document.addEventListener("DOMContentLoaded", () => {
                    document.body.classList.add(theme + "-mode");
                    document.body.classList.remove((theme === DARK ? LIGHT : DARK) + "-mode");
                });
            }
        })();
    </script>
    
    <!-- Critical CSS to prevent flash -->
    <style>
        :root[data-theme="dark"] {
            --background-color: #202124;
            --background-color-transparent: rgba(32, 33, 36, 0.6);
            --second-background-color: #2d2e32;
            --third-background-color: #34353a;
            --third-background-color-transparent: rgba(32, 33, 36, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #ffffff;
            --second-text-color: #eeeeee;
            --third-text-color: #bebec6;
            --fourth-text-color: #999999;
            --default-text-color: #bebec6;
            --invert-text-color: #373D3F;
            --border-color: rgba(255, 255, 255, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(255, 255, 255, 0.08);
            --shadow-color-2: rgba(255, 255, 255, 0.05);
        }
        
        :root[data-theme="light"] {
            --background-color: #fff;
            --background-color-transparent: rgba(255, 255, 255, 0.6);
            --second-background-color: #f8f8f8;
            --third-background-color: #f2f2f2;
            --third-background-color-transparent: rgba(241, 241, 241, 0.6);
            --primary-color: #0066CC;
            --first-text-color: #16171a;
            --second-text-color: #2f3037;
            --third-text-color: #5e5e5e;
            --fourth-text-color: #eeeeee;
            --default-text-color: #373D3F;
            --invert-text-color: #bebec6;
            --border-color: rgba(0, 0, 0, 0.08);
            --selection-color: #0066CC;
            --shadow-color-1: rgba(0, 0, 0, 0.08);
            --shadow-color-2: rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
        
        /* Apply body classes as soon as DOM is ready */
        :root[data-theme="dark"] body {
            background-color: var(--background-color);
            color: var(--default-text-color);
        }
    </style>
    
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://houqian.github.io/2019/07/18/使用vim的宏录制功能格式化注释文档/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
    
    
        
        <meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:type" content="article">
<meta property="og:title" content="使用vim的宏录制功能格式化注释文档">
<meta property="og:url" content="http://houqian.github.io/2019/07/18/%E4%BD%BF%E7%94%A8vim%E7%9A%84%E5%AE%8F%E5%BD%95%E5%88%B6%E5%8A%9F%E8%83%BD%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3/index.html">
<meta property="og:site_name" content="且听风吟">
<meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://houqian.github.io/images/redefine-og.webp">
<meta property="article:published_time" content="2019-07-18T03:56:00.000Z">
<meta property="article:modified_time" content="2021-06-05T15:22:12.000Z">
<meta property="article:author" content="侯乾">
<meta property="article:tag" content="心得">
<meta property="article:tag" content="源码剖析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://houqian.github.io/images/redefine-og.webp">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/redefine-favicon.svg">
    <!--- Page Info-->
    
    <title>
        
            使用vim的宏录制功能格式化注释文档 | 且听风吟
        
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/css/build/tailwind.css">

    

    
<link rel="stylesheet" href="/fonts/GeistMono/geist-mono.css">

    
<link rel="stylesheet" href="/fonts/Geist/geist.css">

    <!--- Font Part-->
    
    
    
    
    
    

    <script id="hexo-configurations">
    window.config = {"hostname":"houqian.github.io","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"delete_mask":false,"title_alignment":"left","headings_top_spacing":{"h1":"3.2rem","h2":"2.4rem","h3":"1.9rem","h4":"1.6rem","h5":"1.4rem","h6":"1.3rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","highlight_theme":{"light":"github","dark":"vs2015"},"font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"pangu_js":false,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null},"title":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":false,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":{"enable":false,"custom_message":null},"side_tools":{"gear_rotation":true,"auto_expand":false},"open_graph":{"enable":true,"image":"/images/redefine-og.webp","description":"Hexo Theme Redefine, Redefine Your Hexo Journey."},"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"跌倒、爬起来、顺手修了 bug","subtitle":{"text":[],"hitokoto":{"enable":false,"show_author":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":true,"version":"11.4.1"}},"version":"2.8.5","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":null},"article_date_format":"auto","excerpt_length":200,"categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 8.1.1"></head>



<body>
	<div class="progress-bar-container">
	

	
	<span class="pjax-progress-bar"></span>
	<!--        <span class="swup-progress-icon">-->
	<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
	<!--        </span>-->
	
</div>

<main class="page-container" id="swup">

	

	<div class="main-content-container flex flex-col justify-between min-h-dvh">
		<div class="main-content-header">
			<header class="navbar-container px-6 md:px-12">
    <div class="navbar-content transition-navbar ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                且听风吟
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            

            
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">43</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">2</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">61</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


		</div>

		<div class="main-content-body transition-fade-up">
			

			<div class="main-content">
				<div class="post-page-container flex relative justify-between box-border w-full h-full">
	<div class="article-content-container">

		<div class="article-title relative w-full">
			
			<div class="w-full flex items-center pt-6 justify-start">
				<h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">使用vim的宏录制功能格式化注释文档</h1>
			</div>
			
		</div>

		
		<div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
			<div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
				<img src="/images/redefine-avatar.svg">
			</div>
			<div class="info flex flex-col justify-between">
				<div class="author flex items-center">
					<span class="name text-default-text-color text-lg font-semibold">侯乾</span>
					
					<span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span>
					
				</div>
				<div class="meta-info">
					<div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2019-07-18 11:56</span>
        <span class="mobile">2019-07-18 11:56</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2019-07-18 11:56</span>
            <span class="mobile">2019-07-18 11:56</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/">计算机科学与技术</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">源码剖析</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%BF%83%E5%BE%97/">心得</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

				</div>
			</div>
		</div>
		

		


		<div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
			<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>经常看各类 javadoc 发现有一类 doc 并没有被做成标准的 doc 格式，直接复制出来想翻译一下，需要做一些预处理，比如删除注释、合并断行，前者各种编辑器的列模式搞定，后者就坑爹了，之前是手工一行一行的删除换行符，然后加空格的，非常坑爹。对于这类重复性操作，使用 vim 的宏录制就再好不过了。</p>
<span id="more"></span>

<h2 id="vim-的宏录制"><a href="#vim-的宏录制" class="headerlink" title="vim 的宏录制"></a>vim 的宏录制</h2><p>宏录制是指将一个操作序列保存后重复回放的功能。分为启动宏录制、进行宏录制、结束宏录制、使用宏录制四个部分。</p>
<table>
<thead>
<tr>
<th>启动宏录制</th>
<th>进行宏录制</th>
<th>结束宏录制</th>
<th>使用宏录制</th>
</tr>
</thead>
<tbody><tr>
<td>normal 模式下，q+储存器名，比如按 qa</td>
<td>正常操作即可，需要注意可重复性</td>
<td>按 q</td>
<td>@+存储器名，比如@a，如果想重复多次，可以 count+@+存储器名，比如 100@a,就会将操作序列 a 重复 100 次</td>
</tr>
</tbody></table>
<h3 id="示例：预处理-CompletableFuture-的设计文档"><a href="#示例：预处理-CompletableFuture-的设计文档" class="headerlink" title="示例：预处理 CompletableFuture 的设计文档"></a>示例：预处理 CompletableFuture 的设计文档</h3><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Overview:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A CompletableFuture may have dependent completion actions,</span></span><br><span class="line"><span class="comment"> * collected in a linked stack. It atomically completes by CASing</span></span><br><span class="line"><span class="comment"> * a result field, and then pops off and runs those actions. This</span></span><br><span class="line"><span class="comment"> * applies across normal vs exceptional outcomes, sync vs async</span></span><br><span class="line"><span class="comment"> * actions, binary triggers, and various forms of completions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Non-nullness of field result (set via CAS) indicates done.  An</span></span><br><span class="line"><span class="comment"> * AltResult is used to box null as a result, as well as to hold</span></span><br><span class="line"><span class="comment"> * exceptions.  Using a single field makes completion simple to</span></span><br><span class="line"><span class="comment"> * detect and trigger.  Encoding and decoding is straightforward</span></span><br><span class="line"><span class="comment"> * but adds to the sprawl of trapping and associating exceptions</span></span><br><span class="line"><span class="comment"> * with targets.  Minor simplifications rely on (static) NIL (to</span></span><br><span class="line"><span class="comment"> * box null results) being the only AltResult with a null</span></span><br><span class="line"><span class="comment"> * exception field, so we don&#x27;t usually need explicit comparisons.</span></span><br><span class="line"><span class="comment"> * Even though some of the generics casts are unchecked (see</span></span><br><span class="line"><span class="comment"> * SuppressWarnings annotations), they are placed to be</span></span><br><span class="line"><span class="comment"> * appropriate even if checked.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Dependent actions are represented by Completion objects linked</span></span><br><span class="line"><span class="comment"> * as Treiber stacks headed by field &quot;stack&quot;. There are Completion</span></span><br><span class="line"><span class="comment"> * classes for each kind of action, grouped into single-input</span></span><br><span class="line"><span class="comment"> * (UniCompletion), two-input (BiCompletion), projected</span></span><br><span class="line"><span class="comment"> * (BiCompletions using either (not both) of two inputs), shared</span></span><br><span class="line"><span class="comment"> * (CoCompletion, used by the second of two sources), zero-input</span></span><br><span class="line"><span class="comment"> * source actions, and Signallers that unblock waiters. Class</span></span><br><span class="line"><span class="comment"> * Completion extends ForkJoinTask to enable async execution</span></span><br><span class="line"><span class="comment"> * (adding no space overhead because we exploit its &quot;tag&quot; methods</span></span><br><span class="line"><span class="comment"> * to maintain claims). It is also declared as Runnable to allow</span></span><br><span class="line"><span class="comment"> * usage with arbitrary executors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Support for each kind of CompletionStage relies on a separate</span></span><br><span class="line"><span class="comment"> * class, along with two CompletableFuture methods:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * * A Completion class with name X corresponding to function,</span></span><br><span class="line"><span class="comment"> *   prefaced with &quot;Uni&quot;, &quot;Bi&quot;, or &quot;Or&quot;. Each class contains</span></span><br><span class="line"><span class="comment"> *   fields for source(s), actions, and dependent. They are</span></span><br><span class="line"><span class="comment"> *   boringly similar, differing from others only with respect to</span></span><br><span class="line"><span class="comment"> *   underlying functional forms. We do this so that users don&#x27;t</span></span><br><span class="line"><span class="comment"> *   encounter layers of adaptors in common usages. We also</span></span><br><span class="line"><span class="comment"> *   include &quot;Relay&quot; classes/methods that don&#x27;t correspond to user</span></span><br><span class="line"><span class="comment"> *   methods; they copy results from one stage to another.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * * Boolean CompletableFuture method x(...) (for example</span></span><br><span class="line"><span class="comment"> *   uniApply) takes all of the arguments needed to check that an</span></span><br><span class="line"><span class="comment"> *   action is triggerable, and then either runs the action or</span></span><br><span class="line"><span class="comment"> *   arranges its async execution by executing its Completion</span></span><br><span class="line"><span class="comment"> *   argument, if present. The method returns true if known to be</span></span><br><span class="line"><span class="comment"> *   complete.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * * Completion method tryFire(int mode) invokes the associated x</span></span><br><span class="line"><span class="comment"> *   method with its held arguments, and on success cleans up.</span></span><br><span class="line"><span class="comment"> *   The mode argument allows tryFire to be called twice (SYNC,</span></span><br><span class="line"><span class="comment"> *   then ASYNC); the first to screen and trap exceptions while</span></span><br><span class="line"><span class="comment"> *   arranging to execute, and the second when called from a</span></span><br><span class="line"><span class="comment"> *   task. (A few classes are not used async so take slightly</span></span><br><span class="line"><span class="comment"> *   different forms.)  The claim() callback suppresses function</span></span><br><span class="line"><span class="comment"> *   invocation if already claimed by another thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * * CompletableFuture method xStage(...) is called from a public</span></span><br><span class="line"><span class="comment"> *   stage method of CompletableFuture x. It screens user</span></span><br><span class="line"><span class="comment"> *   arguments and invokes and/or creates the stage object.  If</span></span><br><span class="line"><span class="comment"> *   not async and x is already complete, the action is run</span></span><br><span class="line"><span class="comment"> *   immediately.  Otherwise a Completion c is created, pushed to</span></span><br><span class="line"><span class="comment"> *   x&#x27;s stack (unless done), and started or triggered via</span></span><br><span class="line"><span class="comment"> *   c.tryFire.  This also covers races possible if x completes</span></span><br><span class="line"><span class="comment"> *   while pushing.  Classes with two inputs (for example BiApply)</span></span><br><span class="line"><span class="comment"> *   deal with races across both while pushing actions.  The</span></span><br><span class="line"><span class="comment"> *   second completion is a CoCompletion pointing to the first,</span></span><br><span class="line"><span class="comment"> *   shared so that at most one performs the action.  The</span></span><br><span class="line"><span class="comment"> *   multiple-arity methods allOf and anyOf do this pairwise to</span></span><br><span class="line"><span class="comment"> *   form trees of completions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that the generic type parameters of methods vary according</span></span><br><span class="line"><span class="comment"> * to whether &quot;this&quot; is a source, dependent, or completion.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Method postComplete is called upon completion unless the target</span></span><br><span class="line"><span class="comment"> * is guaranteed not to be observable (i.e., not yet returned or</span></span><br><span class="line"><span class="comment"> * linked). Multiple threads can call postComplete, which</span></span><br><span class="line"><span class="comment"> * atomically pops each dependent action, and tries to trigger it</span></span><br><span class="line"><span class="comment"> * via method tryFire, in NESTED mode.  Triggering can propagate</span></span><br><span class="line"><span class="comment"> * recursively, so NESTED mode returns its completed dependent (if</span></span><br><span class="line"><span class="comment"> * one exists) for further processing by its caller (see method</span></span><br><span class="line"><span class="comment"> * postFire).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Blocking methods get() and join() rely on Signaller Completions</span></span><br><span class="line"><span class="comment"> * that wake up waiting threads.  The mechanics are similar to</span></span><br><span class="line"><span class="comment"> * Treiber stack wait-nodes used in FutureTask, Phaser, and</span></span><br><span class="line"><span class="comment"> * SynchronousQueue. See their internal documentation for</span></span><br><span class="line"><span class="comment"> * algorithmic details.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Without precautions, CompletableFutures would be prone to</span></span><br><span class="line"><span class="comment"> * garbage accumulation as chains of Completions build up, each</span></span><br><span class="line"><span class="comment"> * pointing back to its sources. So we null out fields as soon as</span></span><br><span class="line"><span class="comment"> * possible (see especially method Completion.detach). The</span></span><br><span class="line"><span class="comment"> * screening checks needed anyway harmlessly ignore null arguments</span></span><br><span class="line"><span class="comment"> * that may have been obtained during races with threads nulling</span></span><br><span class="line"><span class="comment"> * out fields.  We also try to unlink fired Completions from</span></span><br><span class="line"><span class="comment"> * stacks that might never be popped (see method postFire).</span></span><br><span class="line"><span class="comment"> * Completion fields need not be declared as final or volatile</span></span><br><span class="line"><span class="comment"> * because they are only visible to other threads upon safe</span></span><br><span class="line"><span class="comment"> * publication.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></div>

<p>原文档如上所示，为了翻译软件友好，我们需要去除注释&#x2F;**&#x2F;，将断行还原成一行。</p>
<h3 id="去除注释"><a href="#去除注释" class="headerlink" title="去除注释"></a>去除注释</h3><p>control + v 进入列模式，shift + G选至最后一行，方向键调节，d 删除（如果还发现有少量注释，如法炮制一并删除即可）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2019/07/18/%E4%BD%BF%E7%94%A8vim%E7%9A%84%E5%AE%8F%E5%BD%95%E5%88%B6%E5%8A%9F%E8%83%BD%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3/%E6%B8%85%E9%99%A4%E6%B3%A8%E9%87%8A.gif"
                      alt="清除注释"
                ></p>
<h3 id="断行还原成一行"><a href="#断行还原成一行" class="headerlink" title="断行还原成一行"></a>断行还原成一行</h3><p>normal 模式qa, 定位到第二行，i 键进入插入模式，$定位到行首，backspace 删除，此时光标在首行末尾，空格一次（添加空格，防止连词），esc 键退出插入模式，q 键结束录制。此时操作序列已经录制完了，<del>待处理一共 105 行，那么执行 104 次重复即可，所以输入 104@a，</del>  因为有空行的存在，为了不破坏段的效果，这里需要计算好每段的行数-1 次重复，然后迅速定位到下一段（即 段行数-1@a），如法炮制即可。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2019/07/18/%E4%BD%BF%E7%94%A8vim%E7%9A%84%E5%AE%8F%E5%BD%95%E5%88%B6%E5%8A%9F%E8%83%BD%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3/%E6%96%AD%E8%A1%8C%E8%BF%98%E5%8E%9F%E6%88%90%E4%B8%80%E8%A1%8C.gif"
                      alt="断行还原成一行"
                ></p>
<h3 id="效果如下"><a href="#效果如下" class="headerlink" title="效果如下"></a>效果如下</h3><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Overview:</span><br><span class="line"></span><br><span class="line">A CompletableFuture may have dependent completion actions, collected in a linked stack. It atomically completes by CASing a result field, and then pops off and runs those actions. This applies across normal vs exceptional outcomes, sync vs async actions, binary triggers, and various forms of completions.</span><br><span class="line">  </span><br><span class="line">Non-nullness of field <span class="title function_">result</span> <span class="params">(set via CAS)</span> indicates done. An AltResult is used to box <span class="literal">null</span> as a result, as well as to hold exceptions. Using a single field makes completion simple to detect and trigger. Encoding and decoding is straightforward but adds to the sprawl of trapping and associating exceptions with targets. Minor simplifications rely <span class="title function_">on</span> <span class="params">(<span class="keyword">static</span>)</span> NIL (to box <span class="literal">null</span> results) being the only AltResult with a <span class="literal">null</span> exception field, so we don<span class="string">&#x27;t usually need explicit comparisons. Even though some of the generics casts are unchecked (see SuppressWarnings annotations), they are placed to be appropriate even if checked.</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">Dependent actions are represented by Completion objects linked as Treiber stacks headed by field &quot;stack&quot;. There are Completion classes for each kind of action, grouped into single-input (UniCompletion), two-input (BiCompletion), projected (BiCompletions using either (not both) of two inputs), shared (CoCompletion, used by the second of two sources), zero-input source actions, and Signallers that unblock waiters. Class Completion extends ForkJoinTask to enable async execution (adding no space overhead because we exploit its &quot;tag&quot; methods to maintain claims). It is also declared as Runnable to allow usage with arbitrary executors.</span></span><br><span class="line"><span class="string">Support for each kind of CompletionStage relies on a separate class, along with two CompletableFuture methods:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* A Completion class with name X corresponding to function, prefaced with &quot;Uni&quot;, &quot;Bi&quot;, or &quot;Or&quot;. Each class contains fields for source(s), actions, and dependent. They are boringly similar, differing from others only with respect to underlying functional forms. We do this so that users don&#x27;</span>t encounter layers of adaptors in common usages. We also include <span class="string">&quot;Relay&quot;</span> classes/methods that don<span class="string">&#x27;t correspond to user methods; they copy results from one stage to another.</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">* Boolean CompletableFuture method x(...) (for example uniApply) takes all of the arguments needed to check that an action is triggerable, and then either runs the action or arranges its async execution by executing its Completion argument, if present. The method returns true if known to be complete.</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">* Completion method tryFire(int mode) invokes the associated x method with its held arguments, and on success cleans up. The mode argument allows tryFire to be called twice (SYNC, then ASYNC); the first to screen and trap exceptions while arranging to execute, and the second when called from a task. (A few classes are not used async so take slightly different forms.) The claim() callback suppresses function invocation if already claimed by another thread.</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">* CompletableFuture method xStage(...) is called from a public stage method of CompletableFuture x. It screens user arguments and invokes and/or creates the stage object. If not async and x is already complete, the action is run immediately. Otherwise a Completion c is created, pushed to x&#x27;</span>s <span class="title function_">stack</span> <span class="params">(unless done)</span>, and started or triggered via c.tryFire. This also covers races possible <span class="keyword">if</span> x completes <span class="keyword">while</span> pushing. Classes with two <span class="title function_">inputs</span> <span class="params">(<span class="keyword">for</span> example BiApply)</span> deal with races across both <span class="keyword">while</span> pushing actions. The second completion is a CoCompletion pointing to the first, shared so that at most one performs the action. The multiple-arity methods allOf and anyOf <span class="keyword">do</span> <span class="built_in">this</span> pairwise to form trees of completions.</span><br><span class="line">  </span><br><span class="line">Note that the generic type parameters of methods vary according to whether <span class="string">&quot;this&quot;</span> is a source, dependent, or completion.</span><br><span class="line">  </span><br><span class="line">Method postComplete is called upon completion unless the target is guaranteed not to be <span class="title function_">observable</span> <span class="params">(i.e., not yet returned or linked)</span>. Multiple threads can call postComplete, which atomically pops each dependent action, and tries to trigger it via method tryFire, in NESTED mode. Triggering can propagate recursively, so NESTED mode returns its completed <span class="title function_">dependent</span> <span class="params">(<span class="keyword">if</span> one exists)</span> <span class="keyword">for</span> further processing by its <span class="title function_">caller</span> <span class="params">(see method postFire)</span>.</span><br><span class="line">  </span><br><span class="line">Blocking methods <span class="title function_">get</span><span class="params">()</span> and <span class="title function_">join</span><span class="params">()</span> rely on Signaller Completions that wake up waiting threads. The mechanics are similar to Treiber stack wait-nodes used in FutureTask, Phaser, and SynchronousQueue. See their internal documentation <span class="keyword">for</span> algorithmic details.</span><br><span class="line">  </span><br><span class="line">Without precautions, CompletableFutures would be prone to garbage accumulation as chains of Completions build up, each pointing back to its sources. So we <span class="literal">null</span> out fields as soon as <span class="title function_">possible</span> <span class="params">(see especially method Completion.detach)</span>. The screening checks needed anyway harmlessly ignore <span class="literal">null</span> arguments that may have been obtained during races with threads nulling out fields. We also <span class="keyword">try</span> to unlink fired Completions from stacks that might never be <span class="title function_">popped</span> <span class="params">(see method postFire)</span>. Completion fields need not be declared as <span class="keyword">final</span> or <span class="keyword">volatile</span> because they are only visible to other threads upon safe publication</span><br></pre></td></tr></table></figure></div>

<p><strong>一个更骚的操作</strong></p>
<p>仔细观察发现，原文档和标准的 javadoc 非常相似，仅仅是开头少了一个*，如果在空行加上分段标签<p>，那岂不是直接可以使用 idea 渲染成标准 javadoc 了，美滋滋：</p>
<div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Overview:</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * A CompletableFuture may have dependent completion actions,</span></span><br><span class="line"><span class="comment"> * collected in a linked stack. It atomically completes by CASing</span></span><br><span class="line"><span class="comment"> * a result field, and then pops off and runs those actions. This</span></span><br><span class="line"><span class="comment"> * applies across normal vs exceptional outcomes, sync vs async</span></span><br><span class="line"><span class="comment"> * actions, binary triggers, and various forms of completions.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Non-nullness of field result (set via CAS) indicates done.  An</span></span><br><span class="line"><span class="comment"> * AltResult is used to box null as a result, as well as to hold</span></span><br><span class="line"><span class="comment"> * exceptions.  Using a single field makes completion simple to</span></span><br><span class="line"><span class="comment"> * detect and trigger.  Encoding and decoding is straightforward</span></span><br><span class="line"><span class="comment"> * but adds to the sprawl of trapping and associating exceptions</span></span><br><span class="line"><span class="comment"> * with targets.  Minor simplifications rely on (static) NIL (to</span></span><br><span class="line"><span class="comment"> * box null results) being the only AltResult with a null</span></span><br><span class="line"><span class="comment"> * exception field, so we don&#x27;t usually need explicit comparisons.</span></span><br><span class="line"><span class="comment"> * Even though some of the generics casts are unchecked (see</span></span><br><span class="line"><span class="comment"> * SuppressWarnings annotations), they are placed to be</span></span><br><span class="line"><span class="comment"> * appropriate even if checked.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Dependent actions are represented by Completion objects linked</span></span><br><span class="line"><span class="comment"> * as Treiber stacks headed by field &quot;stack&quot;. There are Completion</span></span><br><span class="line"><span class="comment"> * classes for each kind of action, grouped into single-input</span></span><br><span class="line"><span class="comment"> * (UniCompletion), two-input (BiCompletion), projected</span></span><br><span class="line"><span class="comment"> * (BiCompletions using either (not both) of two inputs), shared</span></span><br><span class="line"><span class="comment"> * (CoCompletion, used by the second of two sources), zero-input</span></span><br><span class="line"><span class="comment"> * source actions, and Signallers that unblock waiters. Class</span></span><br><span class="line"><span class="comment"> * Completion extends ForkJoinTask to enable async execution</span></span><br><span class="line"><span class="comment"> * (adding no space overhead because we exploit its &quot;tag&quot; methods</span></span><br><span class="line"><span class="comment"> * to maintain claims). It is also declared as Runnable to allow</span></span><br><span class="line"><span class="comment"> * usage with arbitrary executors.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Support for each kind of CompletionStage relies on a separate</span></span><br><span class="line"><span class="comment"> * class, along with two CompletableFuture methods:</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * * A Completion class with name X corresponding to function,</span></span><br><span class="line"><span class="comment"> *   prefaced with &quot;Uni&quot;, &quot;Bi&quot;, or &quot;Or&quot;. Each class contains</span></span><br><span class="line"><span class="comment"> *   fields for source(s), actions, and dependent. They are</span></span><br><span class="line"><span class="comment"> *   boringly similar, differing from others only with respect to</span></span><br><span class="line"><span class="comment"> *   underlying functional forms. We do this so that users don&#x27;t</span></span><br><span class="line"><span class="comment"> *   encounter layers of adaptors in common usages. We also</span></span><br><span class="line"><span class="comment"> *   include &quot;Relay&quot; classes/methods that don&#x27;t correspond to user</span></span><br><span class="line"><span class="comment"> *   methods; they copy results from one stage to another.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * * Boolean CompletableFuture method x(...) (for example</span></span><br><span class="line"><span class="comment"> *   uniApply) takes all of the arguments needed to check that an</span></span><br><span class="line"><span class="comment"> *   action is triggerable, and then either runs the action or</span></span><br><span class="line"><span class="comment"> *   arranges its async execution by executing its Completion</span></span><br><span class="line"><span class="comment"> *   argument, if present. The method returns true if known to be</span></span><br><span class="line"><span class="comment"> *   complete.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * * Completion method tryFire(int mode) invokes the associated x</span></span><br><span class="line"><span class="comment"> *   method with its held arguments, and on success cleans up.</span></span><br><span class="line"><span class="comment"> *   The mode argument allows tryFire to be called twice (SYNC,</span></span><br><span class="line"><span class="comment"> *   then ASYNC); the first to screen and trap exceptions while</span></span><br><span class="line"><span class="comment"> *   arranging to execute, and the second when called from a</span></span><br><span class="line"><span class="comment"> *   task. (A few classes are not used async so take slightly</span></span><br><span class="line"><span class="comment"> *   different forms.)  The claim() callback suppresses function</span></span><br><span class="line"><span class="comment"> *   invocation if already claimed by another thread.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * * CompletableFuture method xStage(...) is called from a public</span></span><br><span class="line"><span class="comment"> *   stage method of CompletableFuture x. It screens user</span></span><br><span class="line"><span class="comment"> *   arguments and invokes and/or creates the stage object.  If</span></span><br><span class="line"><span class="comment"> *   not async and x is already complete, the action is run</span></span><br><span class="line"><span class="comment"> *   immediately.  Otherwise a Completion c is created, pushed to</span></span><br><span class="line"><span class="comment"> *   x&#x27;s stack (unless done), and started or triggered via</span></span><br><span class="line"><span class="comment"> *   c.tryFire.  This also covers races possible if x completes</span></span><br><span class="line"><span class="comment"> *   while pushing.  Classes with two inputs (for example BiApply)</span></span><br><span class="line"><span class="comment"> *   deal with races across both while pushing actions.  The</span></span><br><span class="line"><span class="comment"> *   second completion is a CoCompletion pointing to the first,</span></span><br><span class="line"><span class="comment"> *   shared so that at most one performs the action.  The</span></span><br><span class="line"><span class="comment"> *   multiple-arity methods allOf and anyOf do this pairwise to</span></span><br><span class="line"><span class="comment"> *   form trees of completions.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Note that the generic type parameters of methods vary according</span></span><br><span class="line"><span class="comment"> * to whether &quot;this&quot; is a source, dependent, or completion.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Method postComplete is called upon completion unless the target</span></span><br><span class="line"><span class="comment"> * is guaranteed not to be observable (i.e., not yet returned or</span></span><br><span class="line"><span class="comment"> * linked). Multiple threads can call postComplete, which</span></span><br><span class="line"><span class="comment"> * atomically pops each dependent action, and tries to trigger it</span></span><br><span class="line"><span class="comment"> * via method tryFire, in NESTED mode.  Triggering can propagate</span></span><br><span class="line"><span class="comment"> * recursively, so NESTED mode returns its completed dependent (if</span></span><br><span class="line"><span class="comment"> * one exists) for further processing by its caller (see method</span></span><br><span class="line"><span class="comment"> * postFire).</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Blocking methods get() and join() rely on Signaller Completions</span></span><br><span class="line"><span class="comment"> * that wake up waiting threads.  The mechanics are similar to</span></span><br><span class="line"><span class="comment"> * Treiber stack wait-nodes used in FutureTask, Phaser, and</span></span><br><span class="line"><span class="comment"> * SynchronousQueue. See their internal documentation for</span></span><br><span class="line"><span class="comment"> * algorithmic details.</span></span><br><span class="line"><span class="comment"> *&lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Without precautions, CompletableFutures would be prone to</span></span><br><span class="line"><span class="comment"> * garbage accumulation as chains of Completions build up, each</span></span><br><span class="line"><span class="comment"> * pointing back to its sources. So we null out fields as soon as</span></span><br><span class="line"><span class="comment"> * possible (see especially method Completion.detach). The</span></span><br><span class="line"><span class="comment"> * screening checks needed anyway harmlessly ignore null arguments</span></span><br><span class="line"><span class="comment"> * that may have been obtained during races with threads nulling</span></span><br><span class="line"><span class="comment"> * out fields.  We also try to unlink fired Completions from</span></span><br><span class="line"><span class="comment"> * stacks that might never be popped (see method postFire).</span></span><br><span class="line"><span class="comment"> * Completion fields need not be declared as final or volatile</span></span><br><span class="line"><span class="comment"> * because they are only visible to other threads upon safe</span></span><br><span class="line"><span class="comment"> * publication.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>





<p>然后按control + j查看文档，哈哈：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2019/07/18/%E4%BD%BF%E7%94%A8vim%E7%9A%84%E5%AE%8F%E5%BD%95%E5%88%B6%E5%8A%9F%E8%83%BD%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%B3%A8%E9%87%8A%E6%96%87%E6%A1%A3/%E6%B8%B2%E6%9F%93%E5%90%8E%E7%9A%84%E6%95%88%E6%9E%9C.png"
                      alt="渲染后的效果"
                ></p>
<h3 id="一个更骚的操作PLUS"><a href="#一个更骚的操作PLUS" class="headerlink" title="一个更骚的操作PLUS"></a>一个更骚的操作PLUS</h3><p>直接开头加上一个*，然后option + command + l 格式化文档，你会发现 idea 自动给你添加 p 标签，太爽了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>vim 操作更加灵活，适应不同的格式化文本需求，不过针对笔者的 case，最简单的方法是：idea 里，新建一个方法，把要格式化的注释拷贝过去，首行添加一个*，格式化文档即可。</p>

		</div>

		
		<div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
			<div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> 使用vim的宏录制功能格式化注释文档</li>
        <li><strong>Author:</strong> 侯乾</li>
        <li><strong>Created at
                :</strong> 2019-07-18 11:56:00</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2019-07-18 11:56:00
            </li>
        
        <li>
            <strong>Link:</strong> http://houqian.github.io/2019/07/18/使用vim的宏录制功能格式化注释文档/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

		</div>
		

		
		<ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
			
			<li class="tag-item mx-0.5">
				<a href="/tags/%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/">#源码剖析</a>&nbsp;
			</li>
			
			<li class="tag-item mx-0.5">
				<a href="/tags/%E5%BF%83%E5%BE%97/">#心得</a>&nbsp;
			</li>
			
		</ul>
		

		

		
		<div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
			
			<div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="prev" rel="prev" href="/2019/12/05/Spring-Cloud-Netflix%E6%8A%80%E6%9C%AF%E6%A0%88%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/">
					<span class="left arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-left"></i>
					</span>
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">Spring Cloud Netflix技术栈系列文章</span>
						<span class="post-nav-item">Prev posts</span>
					</span>
				</a>
			</div>
			
			
			<div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
				<a class="next" rel="next" href="/2019/06/01/%E4%B8%80%E5%BC%A0%E5%9B%BE%E6%BE%84%E6%B8%85%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">
					<span class="title flex justify-center items-center">
						<span class="post-nav-title-item truncate max-w-48">一张图澄清架构设计模式</span>
						<span class="post-nav-item">Next posts</span>
					</span>
					<span class="right arrow-icon flex justify-center items-center">
						<i class="fa-solid fa-chevron-right"></i>
					</span>
				</a>
			</div>
			
		</div>
		


		
		<div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
			<div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          dark: 'body[class~="dark-mode"]',
          reaction: false,
          requiredMeta: ['nick', 'mail'],
          emoji: [],
                    lang: 'zh-CN',
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

		</div>
		
	</div>

	
	<div class="toc-content-container">
		<div class="post-toc-wrap">
	<div class="post-toc">
		<div class="toc-title">On this page</div>
		<div class="page-title">使用vim的宏录制功能格式化注释文档</div>
		<ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%B7%E5%9B%A0"><span class="nav-text">起因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vim-%E7%9A%84%E5%AE%8F%E5%BD%95%E5%88%B6"><span class="nav-text">vim 的宏录制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E9%A2%84%E5%A4%84%E7%90%86-CompletableFuture-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="nav-text">示例：预处理 CompletableFuture 的设计文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%BB%E9%99%A4%E6%B3%A8%E9%87%8A"><span class="nav-text">去除注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%AD%E8%A1%8C%E8%BF%98%E5%8E%9F%E6%88%90%E4%B8%80%E8%A1%8C"><span class="nav-text">断行还原成一行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%E5%A6%82%E4%B8%8B"><span class="nav-text">效果如下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E6%9B%B4%E9%AA%9A%E7%9A%84%E6%93%8D%E4%BD%9CPLUS"><span class="nav-text">一个更骚的操作PLUS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol>

	</div>
</div>
	</div>
	
</div>
			</div>

			
		</div>

		<div class="main-content-footer">
			<footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">侯乾</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        61 posts in total
                    </span>
                    
                </p>
            
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
		</div>
	</div>

	
	<div class="post-tools">
		<div class="post-tools-container">
	<ul class="article-tools-list">
		<!-- TOC aside toggle -->
		
		<li class="right-bottom-tools page-aside-toggle">
			<i class="fa-regular fa-outdent"></i>
		</li>
		

		<!-- go comment -->
		
		<li class="go-comment">
			<i class="fa-regular fa-comments"></i>
		</li>
		
	</ul>
</div>
	</div>
	

	<div class="right-side-tools-container">
		<div class="side-tools-container">
	<ul class="hidden-tools-list">
		<li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-plus"></i>
		</li>

		<li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
			<i class="fa-regular fa-magnifying-glass-minus"></i>
		</li>

		<li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
			<i class="fa-regular fa-moon"></i>
		</li>

		<!-- rss -->
		

		

		<li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
			<i class="fa-regular fa-arrow-down"></i>
		</li>
	</ul>

	<ul class="visible-tools-list">
		<li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
			<i class="fa-regular fa-cog fa-spin"></i>
		</li>
		
		<li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
			<i class="arrow-up fas fa-arrow-up"></i>
			<span class="percent"></span>
		</li>
		
		
	</ul>
</div>
	</div>

	<div class="image-viewer-container">
	<img src="">
</div>

	

</main>



<script src="/js/build/libs/Swup.min.js"></script>

<script src="/js/build/libs/SwupSlideTheme.min.js"></script>

<script src="/js/build/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/build/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/build/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/build/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>




	
<script src="/js/build/tools/imageViewer.js" type="module"></script>

<script src="/js/build/utils.js" type="module"></script>

<script src="/js/build/main.js" type="module"></script>

<script src="/js/build/layouts/navbarShrink.js" type="module"></script>

<script src="/js/build/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/build/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/build/layouts/categoryList.js" type="module"></script>





    
<script src="/js/build/tools/codeBlock.js" type="module"></script>




    
<script src="/js/build/layouts/lazyload.js" type="module"></script>




    
<script src="/js/build/tools/runtime.js"></script>

    
<script src="/js/build/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/build/libs/Typed.min.js"></script>

  
<script src="/js/build/plugins/typed.js" type="module"></script>




    
        
<script src="/js/build/libs/mermaid.min.js"></script>

    
    
<script src="/js/build/plugins/mermaid.js"></script>






    
<script src="/js/build/libs/anime.min.js"></script>





    
<script src="/js/build/tools/tocToggle.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/layouts/toc.js" type="module" data-swup-reload-script=""></script>

<script src="/js/build/plugins/tabs.js" type="module" data-swup-reload-script=""></script>




<script src="/js/build/libs/moment-with-locales.min.js" data-swup-reload-script=""></script>


<script src="/js/build/layouts/essays.js" type="module" data-swup-reload-script=""></script>





	
</body>

</html>